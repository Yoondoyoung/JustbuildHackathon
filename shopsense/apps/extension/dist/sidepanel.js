import{s as f}from"./chunks/supabase.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const k=(t,e)=>{var r,o;t.innerHTML="";const n=document.createElement("h2");n.textContent=e.title??"Analyze";const s=document.createElement("p");if(s.textContent=e.summary??"No summary available.",t.appendChild(n),t.appendChild(s),e.price){const a=document.createElement("div");a.className="meta-row",a.textContent=`Price: ${e.price.value} ${e.price.currency}`,t.appendChild(a)}if(e.rating!==void 0){const a=document.createElement("div");a.className="meta-row",a.textContent=`Rating: ${e.rating}`,t.appendChild(a)}if(e.review_count!==void 0){const a=document.createElement("div");a.className="meta-row",a.textContent=`Reviews: ${e.review_count}`,t.appendChild(a)}if((r=e.key_points)!=null&&r.length){const a=document.createElement("ul");e.key_points.forEach(c=>{const i=document.createElement("li");i.textContent=c,a.appendChild(i)}),t.appendChild(a)}if(e.specs&&Object.keys(e.specs).length>0){const a=document.createElement("div");a.className="specs",Object.entries(e.specs).forEach(([c,i])=>{const d=document.createElement("div");d.className="spec-row",d.textContent=`${c}: ${i}`,a.appendChild(d)}),t.appendChild(a)}if((o=e.citations)!=null&&o.length){const a=document.createElement("div");a.className="citations",e.citations.forEach(c=>{const i=document.createElement("a");i.href=c.url,i.target="_blank",i.rel="noreferrer",i.textContent=c.title??c.url,a.appendChild(i)}),t.appendChild(a)}},N=(t,e)=>{var r;const n=document.createElement("div");n.className=`chat-message ${e.role}`;const s=document.createElement("div");if(s.className="chat-text",s.textContent=e.content,n.appendChild(s),(r=e.citations)!=null&&r.length){const o=document.createElement("div");o.className="chat-citations",e.citations.forEach(a=>{const c=document.createElement("a");c.href=a.url,c.target="_blank",c.rel="noreferrer",c.textContent=a.title??a.url,o.appendChild(c)}),n.appendChild(o)}t.appendChild(n),t.scrollTop=t.scrollHeight},z=async()=>{const{data:{session:t}}=await f.auth.getSession();return{isAuthenticated:!!t,user:(t==null?void 0:t.user)??null}},O=async(t,e)=>{const{data:n,error:s}=await f.auth.signUp({email:t,password:e});if(s)throw s;return n},P=async(t,e)=>{const{data:n,error:s}=await f.auth.signInWithPassword({email:t,password:e});if(s)throw s;return n},$=t=>f.auth.onAuthStateChange((e,n)=>{t({isAuthenticated:!!n,user:(n==null?void 0:n.user)??null})}),H=(t,e)=>{t.innerHTML="";const n=document.createElement("div");n.className="auth-container";const s=document.createElement("h2");s.textContent="ShopSense",s.className="auth-title",n.appendChild(s);const r=document.createElement("div");r.className="auth-tabs";const o=document.createElement("button");o.textContent="로그인",o.className="auth-tab active",o.dataset.mode="login";const a=document.createElement("button");a.textContent="회원가입",a.className="auth-tab",a.dataset.mode="signup",r.appendChild(o),r.appendChild(a),n.appendChild(r);const c=document.createElement("form");c.className="auth-form";const i=document.createElement("input");i.type="email",i.placeholder="이메일",i.required=!0,i.className="auth-input",c.appendChild(i);const d=document.createElement("input");d.type="password",d.placeholder="비밀번호",d.required=!0,d.className="auth-input",c.appendChild(d);const l=document.createElement("div");l.className="auth-error",l.style.display="none",c.appendChild(l);const u=document.createElement("button");u.type="submit",u.textContent="로그인",u.className="btn btn-primary auth-submit",c.appendChild(u),n.appendChild(c),t.appendChild(n);let h="login";const L=p=>{h=p,o.classList.toggle("active",p==="login"),a.classList.toggle("active",p==="signup"),u.textContent=p==="login"?"로그인":"회원가입",l.style.display="none",l.textContent=""};o.addEventListener("click",()=>L("login")),a.addEventListener("click",()=>L("signup")),c.addEventListener("submit",async p=>{p.preventDefault(),l.style.display="none",l.textContent="";const C=i.value.trim(),E=d.value;if(!C||!E){l.textContent="이메일과 비밀번호를 입력해주세요.",l.style.display="block";return}u.disabled=!0,u.textContent=h==="login"?"로그인 중...":"회원가입 중...";try{h==="login"?await P(C,E):await O(C,E),e()}catch(_){l.textContent=_.message||"오류가 발생했습니다.",l.style.display="block"}finally{u.disabled=!1,u.textContent=h==="login"?"로그인":"회원가입"}})},b=document.querySelector("#status-dot"),D=document.querySelector("#status-text"),q=document.querySelector("#analyze"),A=document.querySelector("#chat"),U=document.querySelector("#analyze-btn"),I=document.querySelector("#chat-form"),v=document.querySelector("#chat-input"),y=document.querySelector("#auth-container"),T=document.querySelector("#main-content"),m=t=>{D.textContent=t;const e=t.toLowerCase();b.classList.remove("busy","error"),e.includes("fail")||e.includes("error")?b.classList.add("error"):(e.includes("analyz")||e.includes("send"))&&b.classList.add("busy")},x=async()=>{var n;const e=(n=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0])==null?void 0:n.id;if(typeof e!="number")throw new Error("No active tab found");return e},M=async t=>{await chrome.runtime.sendMessage(t)},w=()=>{y.style.display="none",T.style.display="block"},g=()=>{y.style.display="flex",T.style.display="none",y.innerHTML="",H(y,w)},S=async()=>{try{const t=await x(),e=await chrome.runtime.sendMessage({type:"PANEL_INIT",tabId:t});e!=null&&e.result&&k(q,e.result),Array.isArray(e==null?void 0:e.history)&&e.history.forEach(n=>{N(A,n)})}catch{m("Unable to initialize panel.")}},R=async()=>{try{(await z()).isAuthenticated?(w(),await S()):g(),$(e=>{e.isAuthenticated?(w(),S()):g()})}catch(t){console.error("Auth check failed:",t),g()}};U.addEventListener("click",async()=>{try{m("Analyzing...");const t=await x();await M({type:"ANALYZE_CLICK",tabId:t})}catch{m("Analyze failed.")}});I.addEventListener("submit",async t=>{t.preventDefault();const e=v.value.trim();if(e)try{const n=await x();N(A,{role:"user",content:e}),v.value="",await M({type:"CHAT_SEND",tabId:n,question:e})}catch{m("Chat failed.")}});v.addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),I.requestSubmit())});chrome.runtime.onMessage.addListener((t,e,n)=>t.type==="STATUS"?(m(t.message),n({ok:!0}),!0):t.type==="ERROR"?(m(t.message),n({ok:!0}),!0):t.type==="ANALYZE_RESULT"?(k(q,t.result),m("Analyze completed"),n({ok:!0}),!0):t.type==="CHAT_RESPONSE"?(N(A,t.message),m("Chat ready"),n({ok:!0}),!0):!1);R();
