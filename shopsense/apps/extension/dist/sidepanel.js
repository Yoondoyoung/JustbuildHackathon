import{s as k}from"./chunks/supabase.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=s(r);fetch(r.href,c)}})();const G=(t,e)=>e==="USD"?`$${t.toFixed(2)}`:`${t} ${e}`,J=t=>{const e=Math.floor(t),s=t%1>=.5;let n="";for(let r=0;r<5;r++){const c=r<e||r===e&&s;n+=`<span class="star ${c?"":"outline"}" aria-hidden="true">${c?"★":"☆"}</span>`}return n},V='<svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1.5"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>',X='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>',ee='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>',Q=(t,e,s,n)=>{var c,l;t.innerHTML="";const r=document.createElement("h2");if(r.className="product-title",r.textContent=e.title??"Product",t.appendChild(r),e.price){const a=document.createElement("div");a.className="metric-block",a.innerHTML=`
      <div class="metric-icon" aria-hidden="true">${V}</div>
      <div class="metric-content">
        <p class="metric-label">Price</p>
        <p class="metric-value">${G(e.price.value,e.price.currency)}</p>
      </div>
    `,t.appendChild(a)}if(e.rating!==void 0){const a=document.createElement("div");a.className="metric-block",a.innerHTML=`
      <div class="metric-icon" aria-hidden="true">${X}</div>
      <div class="metric-content">
        <p class="metric-label">Customer Rating</p>
        <div class="metric-value metric-value-rating">
          <div class="stars">${J(e.rating)}</div>
          <span>${e.rating.toFixed(1)}</span>
        </div>
      </div>
    `,t.appendChild(a)}if(e.review_count!==void 0){const a=document.createElement("div");a.className="metric-block";const i=e.review_count===1?"1 review":`${e.review_count.toLocaleString()} reviews`;a.innerHTML=`
      <div class="metric-icon" aria-hidden="true">${ee}</div>
      <div class="metric-content">
        <p class="metric-label">Reviews</p>
        <p class="metric-value">${i}</p>
      </div>
    `,t.appendChild(a)}if(n!=null&&n.overviewEl){n.overviewEl.hidden=!1,n.overviewEl.innerHTML="";const a=e.summary??"No summary available.",i=document.createElement("p");i.style.margin="0",i.textContent=a,n.overviewEl.appendChild(i)}if(n!=null&&n.highlightsEl)if(n.highlightsEl.innerHTML="",(c=e.key_points)!=null&&c.length){const a=document.createElement("ul");a.style.margin="0",a.style.paddingLeft="18px",e.key_points.forEach(i=>{const o=document.createElement("li");o.textContent=i,a.appendChild(o)}),n.highlightsEl.appendChild(a)}else{const a=document.createElement("p");a.style.margin="0",a.style.color="var(--text-secondary)",a.textContent="No highlights available.",n.highlightsEl.appendChild(a)}if(n!=null&&n.specsEl)if(n.specsEl.innerHTML="",e.specs&&Object.keys(e.specs).length>0)Object.entries(e.specs).forEach(([a,i])=>{const o=document.createElement("div");o.className="spec-row",o.innerHTML=`<span class="spec-key">${U(a)}</span><span class="spec-val">${U(i)}</span>`,n.specsEl.appendChild(o)});else{const a=document.createElement("p");a.style.margin="0",a.style.color="var(--text-secondary)",a.textContent="No specs available.",n.specsEl.appendChild(a)}n!=null&&n.quickQuestionsEl&&((l=e.suggested_questions)!=null&&l.length)&&(n.quickQuestionsEl.innerHTML="",e.suggested_questions.forEach(a=>{const i=document.createElement("button");i.type="button",i.className="chip-btn",i.textContent=a,s&&i.addEventListener("click",()=>s(a)),n.quickQuestionsEl.appendChild(i)}))};function U(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function w(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function te(t){if(!t||typeof t!="string")return"";const e=[],s=/\[([^\]]+)\]\((https?:\/\/[^)]+)\)/g;let n=0,r;for(;(r=s.exec(t))!==null;)e.push(w(t.slice(n,r.index)).replace(/\n/g,"<br>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")),e.push(`<a href="${w(r[2])}" target="_blank" rel="noreferrer noopener">${w(r[1])}</a>`),n=s.lastIndex;return e.push(w(t.slice(n)).replace(/\n/g,"<br>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")),e.join("")}const O=(t,e)=>{var r;const s=document.createElement("div");s.className=`chat-message ${e.role}`;const n=document.createElement("div");if(n.className="chat-text",n.innerHTML=te(e.content),s.appendChild(n),(r=e.citations)!=null&&r.length){const c=document.createElement("div");c.className="chat-citations",e.citations.forEach(l=>{const a=document.createElement("a");a.href=l.url,a.target="_blank",a.rel="noreferrer",a.textContent=l.title??l.url,c.appendChild(a)}),s.appendChild(c)}t.appendChild(s),t.scrollTop=t.scrollHeight},ne=async()=>{const{data:{session:t}}=await k.auth.getSession();return{isAuthenticated:!!t,user:(t==null?void 0:t.user)??null}},ae=async(t,e)=>{const{data:s,error:n}=await k.auth.signUp({email:t,password:e});if(n)throw n;return s},se=async(t,e)=>{const{data:s,error:n}=await k.auth.signInWithPassword({email:t,password:e});if(n)throw n;return s},re=t=>k.auth.onAuthStateChange((e,s)=>{t({isAuthenticated:!!s,user:(s==null?void 0:s.user)??null})}),ce=(t,e)=>{t.innerHTML="";const s=document.createElement("div");s.className="auth-container";const n=document.createElement("h2");n.textContent="ShopSense",n.className="auth-title",s.appendChild(n);const r=document.createElement("div");r.className="auth-tabs";const c=document.createElement("button");c.textContent="로그인",c.className="auth-tab active",c.dataset.mode="login";const l=document.createElement("button");l.textContent="회원가입",l.className="auth-tab",l.dataset.mode="signup",r.appendChild(c),r.appendChild(l),s.appendChild(r);const a=document.createElement("form");a.className="auth-form";const i=document.createElement("input");i.type="email",i.placeholder="이메일",i.required=!0,i.className="auth-input",a.appendChild(i);const o=document.createElement("input");o.type="password",o.placeholder="비밀번호",o.required=!0,o.className="auth-input",a.appendChild(o);const d=document.createElement("div");d.className="auth-error",d.style.display="none",a.appendChild(d);const h=document.createElement("button");h.type="submit",h.textContent="로그인",h.className="btn btn-primary auth-submit",a.appendChild(h),s.appendChild(a),t.appendChild(s);let E="login";const D=p=>{E=p,c.classList.toggle("active",p==="login"),l.classList.toggle("active",p==="signup"),h.textContent=p==="login"?"로그인":"회원가입",d.style.display="none",d.textContent=""};c.addEventListener("click",()=>D("login")),l.addEventListener("click",()=>D("signup")),a.addEventListener("submit",async p=>{p.preventDefault(),d.style.display="none",d.textContent="";const q=i.value.trim(),N=o.value;if(!q||!N){d.textContent="이메일과 비밀번호를 입력해주세요.",d.style.display="block";return}h.disabled=!0,h.textContent=E==="login"?"로그인 중...":"회원가입 중...";try{E==="login"?await se(q,N):await ae(q,N),e()}catch(Z){d.textContent=Z.message||"오류가 발생했습니다.",d.style.display="block"}finally{h.disabled=!1,h.textContent=E==="login"?"로그인":"회원가입"}})},L=document.querySelector("#status-dot"),ie=document.querySelector("#status-text"),j=document.querySelector("#analyze"),z=document.querySelector("#chat"),A=document.querySelector("#analyze-btn"),P=document.querySelector("#chat-form"),b=document.querySelector("#chat-input"),le=document.querySelector("#chat-section"),S=document.querySelector("#auth-container"),K=document.querySelector("#main-content"),T=document.querySelector("#good-choice-btn"),m=document.querySelector("#tab-overview"),y=document.querySelector("#tab-highlights"),f=document.querySelector("#tab-specs"),H=document.querySelector("#tab-content-overview"),$=document.querySelector("#tab-content-highlights"),I=document.querySelector("#tab-content-specs"),oe=document.querySelector("#quick-questions"),v=document.querySelector("#result-area"),W=()=>({overviewEl:H,highlightsEl:$,specsEl:I,quickQuestionsEl:oe}),u=t=>{ie.textContent=t;const e=t.toLowerCase();L.classList.remove("busy","error","complete"),e.includes("fail")||e.includes("error")?L.classList.add("error"):e==="analysis complete"?L.classList.add("complete"):(e.includes("analyz")||e.includes("send")||e.includes("generat")||e.includes("working")||e.includes("fetch"))&&L.classList.add("busy")},x=async()=>{var s;const e=(s=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0])==null?void 0:s.id;if(typeof e!="number")throw new Error("No active tab found");return e},B=async t=>{await chrome.runtime.sendMessage(t)},g=t=>{var e;le.style.display=t?"block":"none",b.disabled=!t,(e=P.querySelector("button[type='submit']"))==null||e.toggleAttribute("disabled",!t),t||(b.value="")},C=t=>{[m,y,f].forEach(e=>e.classList.remove("active")),[H,$,I].forEach(e=>{e.hidden=!0}),t==="overview"?(m.classList.add("active"),m.setAttribute("aria-selected","true"),y.setAttribute("aria-selected","false"),f.setAttribute("aria-selected","false"),H.hidden=!1):t==="highlights"?(y.classList.add("active"),y.setAttribute("aria-selected","true"),m.setAttribute("aria-selected","false"),f.setAttribute("aria-selected","false"),$.hidden=!1):(f.classList.add("active"),f.setAttribute("aria-selected","true"),m.setAttribute("aria-selected","false"),y.setAttribute("aria-selected","false"),I.hidden=!1)};A.disabled=!0;g(!1);const _=()=>{S.style.display="none",K.style.display="block",A.disabled=!1,g(!1)},M=()=>{S.style.display="flex",K.style.display="none",A.disabled=!0,g(!1),S.innerHTML="",ce(S,_)},Y=async t=>{try{const e=await x();await B({type:"CHAT_SEND",tabId:e,question:t})}catch{u("Failed to send question.")}},F=async()=>{try{const t=await x(),e=await chrome.runtime.sendMessage({type:"PANEL_INIT",tabId:t});e!=null&&e.result?(v&&(v.style.display="block"),Q(j,e.result,Y,W()),g(!0),u("Analysis Complete"),T.style.display="inline-flex",C("overview")):(v&&(v.style.display="none"),g(!1),T.style.display="none",u("Idle")),Array.isArray(e==null?void 0:e.history)&&e.history.forEach(s=>{O(z,s)})}catch{u("Unable to initialize panel.")}},de=async()=>{try{(await ne()).isAuthenticated?(_(),await F()):M(),re(e=>{e.isAuthenticated?(_(),F()):M()})}catch(t){console.error("Auth check failed:",t),M()}};A.addEventListener("click",async()=>{try{u("Analyzing...");const t=await x();await B({type:"ANALYZE_CLICK",tabId:t})}catch{u("Analyze failed.")}});P.addEventListener("submit",async t=>{t.preventDefault();const e=b.value.trim();if(e)try{const s=await x();O(z,{role:"user",content:e}),b.value="",await B({type:"CHAT_SEND",tabId:s,question:e})}catch{u("Chat failed.")}});b.addEventListener("keydown",t=>{t.isComposing||t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),P.requestSubmit())});chrome.runtime.onMessage.addListener((t,e,s)=>t.type==="STATUS"?(u(t.message),s({ok:!0}),!0):t.type==="ERROR"?(u(t.message),s({ok:!0}),!0):t.type==="ANALYZE_RESULT"?(v&&(v.style.display="block"),Q(j,t.result,Y,W()),g(!0),u("Analysis Complete"),T.style.display="inline-flex",C("overview"),s({ok:!0}),!0):t.type==="CHAT_RESPONSE"?(O(z,t.message),u("Chat ready"),s({ok:!0}),!0):!1);m.addEventListener("click",()=>C("overview"));y.addEventListener("click",()=>C("highlights"));f.addEventListener("click",()=>C("specs"));const R=document.querySelector("#close-btn");R&&R.addEventListener("click",()=>{window.close()});de();
