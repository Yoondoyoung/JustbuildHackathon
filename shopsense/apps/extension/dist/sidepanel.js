(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function r(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(c){if(c.ep)return;c.ep=!0;const a=r(c);fetch(c.href,a)}})();const h=(t,e)=>{var c,a;t.innerHTML="";const r=document.createElement("h2");r.textContent=e.title??"Analyze";const s=document.createElement("p");if(s.textContent=e.summary??"No summary available.",t.appendChild(r),t.appendChild(s),e.price){const n=document.createElement("div");n.className="meta-row",n.textContent=`Price: ${e.price.value} ${e.price.currency}`,t.appendChild(n)}if(e.rating!==void 0){const n=document.createElement("div");n.className="meta-row",n.textContent=`Rating: ${e.rating}`,t.appendChild(n)}if(e.review_count!==void 0){const n=document.createElement("div");n.className="meta-row",n.textContent=`Reviews: ${e.review_count}`,t.appendChild(n)}if((c=e.key_points)!=null&&c.length){const n=document.createElement("ul");e.key_points.forEach(o=>{const i=document.createElement("li");i.textContent=o,n.appendChild(i)}),t.appendChild(n)}if(e.specs&&Object.keys(e.specs).length>0){const n=document.createElement("div");n.className="specs",Object.entries(e.specs).forEach(([o,i])=>{const d=document.createElement("div");d.className="spec-row",d.textContent=`${o}: ${i}`,n.appendChild(d)}),t.appendChild(n)}if((a=e.citations)!=null&&a.length){const n=document.createElement("div");n.className="citations",e.citations.forEach(o=>{const i=document.createElement("a");i.href=o.url,i.target="_blank",i.rel="noreferrer",i.textContent=o.title??o.url,n.appendChild(i)}),t.appendChild(n)}},m=(t,e)=>{var c;const r=document.createElement("div");r.className=`chat-message ${e.role}`;const s=document.createElement("div");if(s.className="chat-text",s.textContent=e.content,r.appendChild(s),(c=e.citations)!=null&&c.length){const a=document.createElement("div");a.className="chat-citations",e.citations.forEach(n=>{const o=document.createElement("a");o.href=n.url,o.target="_blank",o.rel="noreferrer",o.textContent=n.title??n.url,a.appendChild(o)}),r.appendChild(a)}t.appendChild(r),t.scrollTop=t.scrollHeight},u=document.querySelector("#status-dot"),v=document.querySelector("#status-text"),C=document.querySelector("#analyze"),p=document.querySelector("#chat"),b=document.querySelector("#analyze-btn"),w=document.querySelector("#chat-form"),y=document.querySelector("#chat-input"),l=t=>{v.textContent=t;const e=t.toLowerCase();u.classList.remove("busy","error"),e.includes("fail")||e.includes("error")?u.classList.add("error"):(e.includes("analyz")||e.includes("send"))&&u.classList.add("busy")},f=async()=>{var r;const e=(r=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0])==null?void 0:r.id;if(typeof e!="number")throw new Error("No active tab found");return e},E=async t=>{await chrome.runtime.sendMessage(t)},N=async()=>{try{const t=await f(),e=await chrome.runtime.sendMessage({type:"PANEL_INIT",tabId:t});e!=null&&e.result&&h(C,e.result),Array.isArray(e==null?void 0:e.history)&&e.history.forEach(r=>{m(p,r)})}catch{l("Unable to initialize panel.")}};b.addEventListener("click",async()=>{try{l("Analyzing...");const t=await f();await E({type:"ANALYZE_CLICK",tabId:t})}catch{l("Analyze failed.")}});w.addEventListener("submit",async t=>{t.preventDefault();const e=y.value.trim();if(e)try{const r=await f();m(p,{role:"user",content:e}),y.value="",await E({type:"CHAT_SEND",tabId:r,question:e})}catch{l("Chat failed.")}});chrome.runtime.onMessage.addListener((t,e,r)=>t.type==="STATUS"?(l(t.message),r({ok:!0}),!0):t.type==="ERROR"?(l(t.message),r({ok:!0}),!0):t.type==="ANALYZE_RESULT"?(h(C,t.result),l("Analyze completed"),r({ok:!0}),!0):t.type==="CHAT_RESPONSE"?(m(p,t.message),l("Chat ready"),r({ok:!0}),!0):!1);N();
