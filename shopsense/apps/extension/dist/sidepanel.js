import{s as f}from"./chunks/supabase.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();const k=(e,t)=>{var r,c;e.innerHTML="";const n=document.createElement("h2");n.textContent=t.title??"Analyze";const s=document.createElement("p");if(s.textContent=t.summary??"No summary available.",e.appendChild(n),e.appendChild(s),t.price){const a=document.createElement("div");a.className="meta-row",a.textContent=`Price: ${t.price.value} ${t.price.currency}`,e.appendChild(a)}if(t.rating!==void 0){const a=document.createElement("div");a.className="meta-row",a.textContent=`Rating: ${t.rating}`,e.appendChild(a)}if(t.review_count!==void 0){const a=document.createElement("div");a.className="meta-row",a.textContent=`Reviews: ${t.review_count}`,e.appendChild(a)}if((r=t.key_points)!=null&&r.length){const a=document.createElement("ul");t.key_points.forEach(o=>{const i=document.createElement("li");i.textContent=o,a.appendChild(i)}),e.appendChild(a)}if(t.specs&&Object.keys(t.specs).length>0){const a=document.createElement("div");a.className="specs",Object.entries(t.specs).forEach(([o,i])=>{const d=document.createElement("div");d.className="spec-row",d.textContent=`${o}: ${i}`,a.appendChild(d)}),e.appendChild(a)}if((c=t.citations)!=null&&c.length){const a=document.createElement("div");a.className="citations",t.citations.forEach(o=>{const i=document.createElement("a");i.href=o.url,i.target="_blank",i.rel="noreferrer",i.textContent=o.title??o.url,a.appendChild(i)}),e.appendChild(a)}},w=(e,t)=>{var r;const n=document.createElement("div");n.className=`chat-message ${t.role}`;const s=document.createElement("div");if(s.className="chat-text",s.textContent=t.content,n.appendChild(s),(r=t.citations)!=null&&r.length){const c=document.createElement("div");c.className="chat-citations",t.citations.forEach(a=>{const o=document.createElement("a");o.href=a.url,o.target="_blank",o.rel="noreferrer",o.textContent=a.title??a.url,c.appendChild(o)}),n.appendChild(c)}e.appendChild(n),e.scrollTop=e.scrollHeight},_=async()=>{const{data:{session:e}}=await f.auth.getSession();return{isAuthenticated:!!e,user:(e==null?void 0:e.user)??null}},z=async(e,t)=>{const{data:n,error:s}=await f.auth.signUp({email:e,password:t});if(s)throw s;return n},O=async(e,t)=>{const{data:n,error:s}=await f.auth.signInWithPassword({email:e,password:t});if(s)throw s;return n},P=e=>f.auth.onAuthStateChange((t,n)=>{e({isAuthenticated:!!n,user:(n==null?void 0:n.user)??null})}),$=(e,t)=>{e.innerHTML="";const n=document.createElement("div");n.className="auth-container";const s=document.createElement("h2");s.textContent="ShopSense",s.className="auth-title",n.appendChild(s);const r=document.createElement("div");r.className="auth-tabs";const c=document.createElement("button");c.textContent="로그인",c.className="auth-tab active",c.dataset.mode="login";const a=document.createElement("button");a.textContent="회원가입",a.className="auth-tab",a.dataset.mode="signup",r.appendChild(c),r.appendChild(a),n.appendChild(r);const o=document.createElement("form");o.className="auth-form";const i=document.createElement("input");i.type="email",i.placeholder="이메일",i.required=!0,i.className="auth-input",o.appendChild(i);const d=document.createElement("input");d.type="password",d.placeholder="비밀번호",d.required=!0,d.className="auth-input",o.appendChild(d);const l=document.createElement("div");l.className="auth-error",l.style.display="none",o.appendChild(l);const u=document.createElement("button");u.type="submit",u.textContent="로그인",u.className="btn btn-primary auth-submit",o.appendChild(u),n.appendChild(o),e.appendChild(n);let h="login";const x=p=>{h=p,c.classList.toggle("active",p==="login"),a.classList.toggle("active",p==="signup"),u.textContent=p==="login"?"로그인":"회원가입",l.style.display="none",l.textContent=""};c.addEventListener("click",()=>x("login")),a.addEventListener("click",()=>x("signup")),o.addEventListener("submit",async p=>{p.preventDefault(),l.style.display="none",l.textContent="";const C=i.value.trim(),g=d.value;if(!C||!g){l.textContent="이메일과 비밀번호를 입력해주세요.",l.style.display="block";return}u.disabled=!0,u.textContent=h==="login"?"로그인 중...":"회원가입 중...";try{h==="login"?await O(C,g):await z(C,g),t()}catch(M){l.textContent=M.message||"오류가 발생했습니다.",l.style.display="block"}finally{u.disabled=!1,u.textContent=h==="login"?"로그인":"회원가입"}})},E=document.querySelector("#status-dot"),H=document.querySelector("#status-text"),q=document.querySelector("#analyze"),N=document.querySelector("#chat"),U=document.querySelector("#analyze-btn"),D=document.querySelector("#chat-form"),L=document.querySelector("#chat-input"),y=document.querySelector("#auth-container"),I=document.querySelector("#main-content"),m=e=>{H.textContent=e;const t=e.toLowerCase();E.classList.remove("busy","error"),t.includes("fail")||t.includes("error")?E.classList.add("error"):(t.includes("analyz")||t.includes("send"))&&E.classList.add("busy")},A=async()=>{var n;const t=(n=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0])==null?void 0:n.id;if(typeof t!="number")throw new Error("No active tab found");return t},T=async e=>{await chrome.runtime.sendMessage(e)},v=()=>{y.style.display="none",I.style.display="block"},b=()=>{y.style.display="flex",I.style.display="none",y.innerHTML="",$(y,v)},S=async()=>{try{const e=await A(),t=await chrome.runtime.sendMessage({type:"PANEL_INIT",tabId:e});t!=null&&t.result&&k(q,t.result),Array.isArray(t==null?void 0:t.history)&&t.history.forEach(n=>{w(N,n)})}catch{m("Unable to initialize panel.")}},R=async()=>{try{(await _()).isAuthenticated?(v(),await S()):b(),P(t=>{t.isAuthenticated?(v(),S()):b()})}catch(e){console.error("Auth check failed:",e),b()}};U.addEventListener("click",async()=>{try{m("Analyzing...");const e=await A();await T({type:"ANALYZE_CLICK",tabId:e})}catch{m("Analyze failed.")}});D.addEventListener("submit",async e=>{e.preventDefault();const t=L.value.trim();if(t)try{const n=await A();w(N,{role:"user",content:t}),L.value="",await T({type:"CHAT_SEND",tabId:n,question:t})}catch{m("Chat failed.")}});chrome.runtime.onMessage.addListener((e,t,n)=>e.type==="STATUS"?(m(e.message),n({ok:!0}),!0):e.type==="ERROR"?(m(e.message),n({ok:!0}),!0):e.type==="ANALYZE_RESULT"?(k(q,e.result),m("Analyze completed"),n({ok:!0}),!0):e.type==="CHAT_RESPONSE"?(w(N,e.message),m("Chat ready"),n({ok:!0}),!0):!1);R();
