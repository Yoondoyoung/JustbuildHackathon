import{s as f}from"./chunks/supabase.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();const k=(t,e,a)=>{var o,s,i;t.innerHTML="";const c=document.createElement("p");if(c.textContent=e.summary??"No summary available.",t.appendChild(c),e.price){const n=document.createElement("div");n.className="meta-row",n.textContent=`Price: ${e.price.value} ${e.price.currency}`,t.appendChild(n)}if(e.rating!==void 0){const n=document.createElement("div");n.className="meta-row",n.textContent=`Rating: ${e.rating}`,t.appendChild(n)}if(e.review_count!==void 0){const n=document.createElement("div");n.className="meta-row",n.textContent=`Reviews: ${e.review_count}`,t.appendChild(n)}if((o=e.key_points)!=null&&o.length){const n=document.createElement("ul");e.key_points.forEach(l=>{const r=document.createElement("li");r.textContent=l,n.appendChild(r)}),t.appendChild(n)}if(e.specs&&Object.keys(e.specs).length>0){const n=document.createElement("div");n.className="specs",Object.entries(e.specs).forEach(([l,r])=>{const d=document.createElement("div");d.className="spec-row",d.textContent=`${l}: ${r}`,n.appendChild(d)}),t.appendChild(n)}if((s=e.citations)!=null&&s.length){const n=document.createElement("div");n.className="citations",e.citations.forEach(l=>{const r=document.createElement("a");r.href=l.url,r.target="_blank",r.rel="noreferrer",r.textContent=l.title??l.url,n.appendChild(r)}),t.appendChild(n)}if((i=e.suggested_questions)!=null&&i.length){const n=document.createElement("div");n.className="suggested-questions",e.suggested_questions.forEach(l=>{const r=document.createElement("button");r.type="button",r.className="suggested-question-btn",r.textContent=l,r.style.display="block",r.style.width="100%",r.style.textAlign="left",r.style.padding="0.5rem 0.75rem",r.style.marginBottom="0.35rem",r.style.cursor="pointer",r.style.border="1px solid var(--border, #e0e0e0)",r.style.borderRadius="4px",r.style.background="var(--bg-secondary, #f5f5f5)",r.style.fontSize="0.9rem",a&&r.addEventListener("click",()=>a(l)),n.appendChild(r)}),t.appendChild(n)}},x=(t,e)=>{var o;const a=document.createElement("div");a.className=`chat-message ${e.role}`;const c=document.createElement("div");if(c.className="chat-text",c.textContent=e.content,a.appendChild(c),(o=e.citations)!=null&&o.length){const s=document.createElement("div");s.className="chat-citations",e.citations.forEach(i=>{const n=document.createElement("a");n.href=i.url,n.target="_blank",n.rel="noreferrer",n.textContent=i.title??i.url,s.appendChild(n)}),a.appendChild(s)}t.appendChild(a),t.scrollTop=t.scrollHeight},O=async()=>{const{data:{session:t}}=await f.auth.getSession();return{isAuthenticated:!!t,user:(t==null?void 0:t.user)??null}},P=async(t,e)=>{const{data:a,error:c}=await f.auth.signUp({email:t,password:e});if(c)throw c;return a},H=async(t,e)=>{const{data:a,error:c}=await f.auth.signInWithPassword({email:t,password:e});if(c)throw c;return a},$=t=>f.auth.onAuthStateChange((e,a)=>{t({isAuthenticated:!!a,user:(a==null?void 0:a.user)??null})}),D=(t,e)=>{t.innerHTML="";const a=document.createElement("div");a.className="auth-container";const c=document.createElement("h2");c.textContent="ShopSense",c.className="auth-title",a.appendChild(c);const o=document.createElement("div");o.className="auth-tabs";const s=document.createElement("button");s.textContent="로그인",s.className="auth-tab active",s.dataset.mode="login";const i=document.createElement("button");i.textContent="회원가입",i.className="auth-tab",i.dataset.mode="signup",o.appendChild(s),o.appendChild(i),a.appendChild(o);const n=document.createElement("form");n.className="auth-form";const l=document.createElement("input");l.type="email",l.placeholder="이메일",l.required=!0,l.className="auth-input",n.appendChild(l);const r=document.createElement("input");r.type="password",r.placeholder="비밀번호",r.required=!0,r.className="auth-input",n.appendChild(r);const d=document.createElement("div");d.className="auth-error",d.style.display="none",n.appendChild(d);const u=document.createElement("button");u.type="submit",u.textContent="로그인",u.className="btn btn-primary auth-submit",n.appendChild(u),a.appendChild(n),t.appendChild(a);let h="login";const S=p=>{h=p,s.classList.toggle("active",p==="login"),i.classList.toggle("active",p==="signup"),u.textContent=p==="login"?"로그인":"회원가입",d.style.display="none",d.textContent=""};s.addEventListener("click",()=>S("login")),i.addEventListener("click",()=>S("signup")),n.addEventListener("submit",async p=>{p.preventDefault(),d.style.display="none",d.textContent="";const g=l.value.trim(),b=r.value;if(!g||!b){d.textContent="이메일과 비밀번호를 입력해주세요.",d.style.display="block";return}u.disabled=!0,u.textContent=h==="login"?"로그인 중...":"회원가입 중...";try{h==="login"?await H(g,b):await P(g,b),e()}catch(z){d.textContent=z.message||"오류가 발생했습니다.",d.style.display="block"}finally{u.disabled=!1,u.textContent=h==="login"?"로그인":"회원가입"}})},E=document.querySelector("#status-dot"),R=document.querySelector("#status-text"),_=document.querySelector("#analyze"),A=document.querySelector("#chat"),U=document.querySelector("#analyze-btn"),I=document.querySelector("#chat-form"),w=document.querySelector("#chat-input"),y=document.querySelector("#auth-container"),T=document.querySelector("#main-content"),m=t=>{R.textContent=t;const e=t.toLowerCase();E.classList.remove("busy","error"),e.includes("fail")||e.includes("error")?E.classList.add("error"):(e.includes("analyz")||e.includes("send"))&&E.classList.add("busy")},C=async()=>{var a;const e=(a=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0])==null?void 0:a.id;if(typeof e!="number")throw new Error("No active tab found");return e},L=async t=>{await chrome.runtime.sendMessage(t)},N=()=>{y.style.display="none",T.style.display="block"},v=()=>{y.style.display="flex",T.style.display="none",y.innerHTML="",D(y,N)},M=async t=>{try{const e=await C();await L({type:"CHAT_SEND",tabId:e,question:t})}catch{m("Failed to send question.")}},q=async()=>{try{const t=await C(),e=await chrome.runtime.sendMessage({type:"PANEL_INIT",tabId:t});e!=null&&e.result&&k(_,e.result,M),Array.isArray(e==null?void 0:e.history)&&e.history.forEach(a=>{x(A,a)})}catch{m("Unable to initialize panel.")}},B=async()=>{try{(await O()).isAuthenticated?(N(),await q()):v(),$(e=>{e.isAuthenticated?(N(),q()):v()})}catch(t){console.error("Auth check failed:",t),v()}};U.addEventListener("click",async()=>{try{m("Analyzing...");const t=await C();await L({type:"ANALYZE_CLICK",tabId:t})}catch{m("Analyze failed.")}});I.addEventListener("submit",async t=>{t.preventDefault();const e=w.value.trim();if(e)try{const a=await C();x(A,{role:"user",content:e}),w.value="",await L({type:"CHAT_SEND",tabId:a,question:e})}catch{m("Chat failed.")}});w.addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),I.requestSubmit())});chrome.runtime.onMessage.addListener((t,e,a)=>t.type==="STATUS"?(m(t.message),a({ok:!0}),!0):t.type==="ERROR"?(m(t.message),a({ok:!0}),!0):t.type==="ANALYZE_RESULT"?(k(_,t.result,M),m("Analyze completed"),a({ok:!0}),!0):t.type==="CHAT_RESPONSE"?(x(A,t.message),m("Chat ready"),a({ok:!0}),!0):!1);B();
